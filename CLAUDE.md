# CLAUDE.md
<!-- Generated by Claude Conductor v1.1.2 -->

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

> **Note**: This is a focused subset of documentation for Claude Code. For complete documentation framework and all guidelines, see [CONDUCTOR.md](CONDUCTOR.md).

## Critical Context (Read First)
- **Tech Stack**: React 19.1.0, TypeScript 4.9.5, Create React App 5.0.1
- **Main File**: src/index.tsx → src/App.tsx (entry point)
- **Core Mechanic**: Genetic algorithm optimizer for financial schedule planning
- **Key Integration**: Web Workers for background optimization, localStorage for persistence
- **Platform Support**: Web application (desktop & mobile responsive)
- **DO NOT**: Modify genetic algorithm parameters without understanding fitness function

## Session Startup Checklist
**IMPORTANT**: At the start of each session, check these items:
1. **Check TASKS.md** - Look for any IN_PROGRESS or BLOCKED tasks from previous sessions
2. **Review recent JOURNAL.md entries** - Scan last 2-3 entries for context
3. **If resuming work**: Load the current task context from TASKS.md before proceeding

## Table of Contents
1. [Architecture](ARCHITECTURE.md) - Tech stack, folder structure, infrastructure
2. [Design Tokens](DESIGN.md) - Colors, typography, visual system
3. [UI/UX Patterns](UIUX.md) - Components, interactions, accessibility
4. [Runtime Config](CONFIG.md) - Environment variables, feature flags
5. [Data Model](DATA_MODEL.md) - Database schema, entities, relationships
6. [API Contracts](API.md) - Endpoints, request/response formats, auth
7. [Build & Release](BUILD.md) - Build process, deployment, CI/CD
8. [Testing Guide](TEST.md) - Test strategies, E2E scenarios, coverage
9. [Operational Playbooks](PLAYBOOKS/DEPLOY.md) - Deployment, rollback, monitoring
10. [Contributing](CONTRIBUTING.md) - Code style, PR process, conventions
11. [Error Ledger](ERRORS.md) - Critical P0/P1 error tracking
12. [Task Management](TASKS.md) - Active tasks, phase tracking, context preservation

## Quick Reference
**Genetic Optimizer**: `src/services/geneticOptimizer.ts` - Core optimization algorithm  
**Schedule Context**: `src/context/ScheduleContext.tsx` - Central schedule state management  
**Configuration Context**: `src/context/ConfigurationContext.tsx` - Optimization settings  
**Schedule Worker**: `src/workers/scheduleWorker.ts` - Background optimization processing  
**Schedule Table**: `src/components/ScheduleTable/ScheduleTable.tsx` - Main schedule display  
**Configuration Panel**: `src/components/ConfigurationPanel/ConfigurationPanel.tsx` - User inputs  
**Summary Component**: `src/components/Summary/Summary.tsx` - Financial metrics display  
**Shift Types**: `src/types.ts:ShiftType` - Large ($86.5), Medium ($67.5), Small ($56.0)  
**Fitness Function**: `src/services/geneticOptimizer.ts:calculateFitness` - Optimization criteria  
**Auto-save Logic**: `src/context/PersistenceContext.tsx` - localStorage persistence

## Current State
- [x] Core genetic algorithm optimization
- [x] Multiple view modes (table/calendar)
- [x] Dark/light theme support
- [x] Data persistence with auto-save
- [x] Export/import functionality
- [x] Mobile responsive design
- [x] Manual constraint editing
- [ ] Multi-user support
- [ ] Cloud sync capabilities

## Development Workflow

### IMPORTANT: Pull Request Requirement
**All code changes MUST go through Pull Requests** to enable Gemini Code Assist review:
1. Create a feature branch: `git checkout -b feature/your-feature-name`
2. Make your changes and commit them
3. Push to GitHub: `git push origin feature/your-feature-name`
4. Create a Pull Request on GitHub
5. Wait for Gemini Code Assist to review (usually within 5 minutes)
6. Address any feedback from Gemini
7. Merge the PR once satisfied with the review

### Local Development Steps
1. Run `npm start` to start development server on port 3000
2. Make changes to components in `src/components/`
3. Update tests in `src/__tests__/` or component test files
4. Run `npm test` to verify unit tests pass
5. Run `npm run lint` to check code quality
6. Test on mobile viewport for responsive design

## Task Templates
### 1. Add New Shift Type
1. Update `ShiftType` enum in `src/types.ts`
2. Add shift value to `SHIFT_VALUES` in `src/services/geneticOptimizer.ts`
3. Update UI in `src/components/ConfigurationPanel/ShiftTypeConfig.tsx`
4. Add test case in `src/__tests__/geneticOptimizer.test.ts`
5. Update help text in configuration panel

### 2. Modify Fitness Function
1. Edit `calculateFitness` in `src/services/geneticOptimizer.ts`
2. Update fitness weights if needed
3. Test with various scenarios in `src/__tests__/integration.test.tsx`
4. Verify optimization still converges properly

### 3. Add New Export Format
1. Create export function in `src/utils/exportUtils.ts`
2. Add button/option in `src/components/ActionBar/ActionBar.tsx`
3. Implement format conversion logic
4. Add unit tests for export function
5. Test file download in browser

## Anti-Patterns (Avoid These)
❌ **Don't push directly to main branch** - Always use PRs for Gemini Code Assist review  
❌ **Don't modify genetic algorithm without testing convergence** - Can break optimization  
❌ **Don't update state directly in components** - Use Context API methods  
❌ **Don't run optimization on main thread** - Always use Web Workers  
❌ **Don't hardcode shift values** - Use constants from geneticOptimizer.ts  
❌ **Don't skip responsive testing** - Mobile users are significant portion  
❌ **Don't remove error boundaries** - Critical for production stability

## Journal Update Requirements
**IMPORTANT**: Update JOURNAL.md regularly throughout our work sessions:
- After completing any significant feature or fix
- When encountering and resolving errors
- At the end of each work session
- When making architectural decisions
- Format: What/Why/How/Issues/Result structure

## Task Management Integration
**How TASKS.md and JOURNAL.md work together**:
1. **Active Work**: TASKS.md tracks current/incomplete tasks with full context
2. **Completed Work**: When tasks complete, they generate JOURNAL.md entries with `|TASK:ID|` tags
3. **History**: JOURNAL.md preserves complete task history even if Claude Code is reinstalled
4. **Context Recovery**: Search JOURNAL.md for `|TASK:` to see all completed tasks over time
5. **Clean Handoffs**: TASKS.md always shows what needs to be resumed or completed

## Version History
- **v1.0.0** - Initial release
- **v1.1.0** - Feature added (see JOURNAL.md YYYY-MM-DD)  
[Link major versions to journal entries]